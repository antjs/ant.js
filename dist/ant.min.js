/*! ant.js 2013-09-26 09:48 */
Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;++c)c in this&&a.call(b,this[c],c,this)}),Array.isArray||(Array.isArray=function(a){return"[object Array]"==={}.toString.call(a)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null==this)throw new TypeError;var b,c,d=Object(this),e=d.length>>>0;if(0===e)return-1;if(b=0,arguments.length>1&&(b=Number(arguments[1]),b!=b?b=0:0!=b&&1/0!=b&&b!=-1/0&&(b=(b>0||-1)*Math.floor(Math.abs(b)))),b>=e)return-1;for(c=b>=0?b:Math.max(e-Math.abs(b),0);e>c;c++)if(c in d&&d[c]===a)return c;return-1}),function(a){var b=this;if("object"==typeof module&&module){var c=b.document||require("jsdom").jsdom();module.exports=a(c)}else a=a(b.document),"function"==typeof define&&define(function(){return a}),b.Ant=a}(function(a){"use strict";function b(a){var b,c=arguments.length;a=a||{};for(var d=1;c>d;d++)if(null!==(b=arguments[d]))for(var e in b)a[e]=b[e];return a}function c(a){a&&(K=a,N.IF=K+"if",N.REPEAT=K+"repeat",N.MODEL=K+"model",d.PREFIX=K)}function d(a,c){c=c||{};var d,f=c.data||{},h=c.events||{};d=e(a,c.el),a=d.tpl,d=d.el,this.tpl=a,this.el=d,this.data={},this.isRendered=!1,this.isLazy=!!c.lazy,this.options=c,this.partials=null;for(var i in h)this.on(i,h[i]);this.trigger("beforeInit"),g(this),this.trigger("build"),this.bindings=(this.bindings||[]).concat(c.bindings||[]),f=b(this.data,f),c.data&&this.render(f),this.init.apply(this,arguments),this.trigger("afterInit")}function e(b,c){var d;return z(b)?(c?(d=c=z(c)?c:a.createElement(c),d.innerHTML="",c.appendChild(b)):d=b,b=d.outerHTML):(d=z(c)?c:a.createElement(c||"div"),d.innerHTML=b),{el:d,tpl:b}}function f(a,b,c){a.$$render(b,c)}function g(a){var b=new m;b.$$root=b,b.$$ant=a,a.vm=b,h(a.el,b)}function h(a,b){if(a.nodeType&&!a.length)i(a,b);else for(var c=0,d=a.length;d>c;c++)i(a[c],b)}function i(a,b){if(8!==a.nodeType){if(3===a.nodeType)return k(b,a,a.parentNode),void 0;if(!j(a,b))for(var c,d=a.firstChild;d;)c=d.nextSibling,i(d,b),d=c}}function j(a,b){var c,d=a.getAttributeNode(N.REPEAT),e=a.getAttributeNode(N.IF),f=a.getAttributeNode(N.MODEL),g=d||e;if(g)return k(b,g,a,g),!0;f&&l(a,f.value,b);for(var h=a.attributes.length-1;h>=0;h--)c=a.attributes[h],k(b,c,a),0===c.nodeName.indexOf(K)&&a.removeAttribute(c.nodeName)}function k(b,c,d,e){if(e||p(c.nodeValue)||p(c.nodeName)){var f=q(c,d,e),g=f.textMap;"text"===f.type&&g.length>1?(g.forEach(function(e){var f=a.createTextNode(e);d.insertBefore(f,c),k(b,f,d)}),d.removeChild(c)):f.forEach(function(a){r(b,a,f)})}}function l(a,b,c){if(b=b.trim()){var d,e=c.$$root.$$ant,f="."===b?c:c.$$getChild(b),g="change",h=d="value",i=A(e.get(f.$$getKeyPath())),j=/\r\n/g,k=function(e){var f=e||c.$$getData(b)||"",e=a[d];e&&e.replace&&(e=e.replace(j,"\n")),f!==e&&(a[d]=f)},l=function(){var b=a[h];b.replace&&(b=b.replace(j,"\n")),e.set(f.$$getKeyPath(),b)};switch(a.tagName){default:h=d="innerHTML",g+=" blur";case"INPUT":case"TEXTAREA":switch(a.type){case"checkbox":h=d="checked",O&&(g+=" click");break;case"radio":d="checked",O&&(g+=" click"),k=function(){a.checked=a.value===c.$$getData(b)},i=a.checked;break;default:e.isLazy||("oninput"in a&&(g+=" input"),O&&(g+=" keyup propertychange cut"))}break;case"SELECT":a.multiple&&(l=function(){for(var b=[],c=0,d=a.options.length;d>c;c++)a.options[c].selected&&b.push(a.options[c].value);e.set(f.$$getKeyPath(),b)},k=function(){var d=c.$$getData(b);if(d&&d.length)for(var e=0,f=a.options.length;f>e;e++)a.options[e].selected=-1!==d.indexOf(a.options[e].value)}),i=i&&!p(a[h])}f.$$watchers.push(k),g.split(/\s+/g).forEach(function(b){J(a,b,l),I(a,b,l)}),a.removeAttribute(N.MODEL),a[h]&&i&&l()}}function m(){this.$$path="",this.$$watchers=[],this._watchers=[],this.$$repeaters=[]}function n(a,b){var c,d,e=["$$repeaters","$$watchers"];if(b){for(var f=0,g=e.length;g>f;f++){c=a[e[f]];for(var h=c.length-1;h>=0;h--)d=c[h],d.el&&b.contains(d.el)&&c.splice(h,1)}for(var i in a)i in m.prototype||n(a[i],b)}}function o(a,b,c){var d,e,f;for(var g in b)d=a[g],e=b[g],a!==e&&"__ant__"!==g&&(B(e)||Array.isArray(e)?(f=Array.isArray(e)?d&&Array.isArray(d)?d:[]:d||{},a[g]=o(f,e,c&&c.$$getChild(g))):a[g]=e);return c&&Array.isArray(a)&&(a.__ant__=c,a.push!==U.push&&o(a,U)),a}function p(a){return P.lastIndex=0,a&&P.test(a)}function q(a,b,c){var d,e,f=[],g=[],h=0,i=a.nodeValue,j=a.nodeName;for(c?f.push({nodeName:j,path:i,el:b,node:a}):3===a.nodeType?e="text":2===a.nodeType&&(e="attr",0===j.indexOf(K)&&(j=a.nodeName.slice(K.length)),p(j)&&(i=j)),P.lastIndex=0;d=P.exec(i);)P.lastIndex-h>d[0].length&&g.push(i.slice(h,P.lastIndex-d[0].length)),f.push({escape:!d[2],path:(d[2]||d[1]).trim(),position:g.length,el:b,node:a,nodeName:j,type:e}),g.push(d[0]),h=P.lastIndex;return i.length>h&&g.push(i.slice(h,i.length)),f.type=e,f.textMap=g,f}function r(a,b,c){s(a.$$root.$$ant.bindings),Q(a,b,c)}function s(a){a=T.concat(a)}function t(a,b,c){this.vm=a,this.fn=c,this.keys=[],this.el=b.el}function u(b,c,d){var e,f=c.position,g=c.node,h=c.el,i=c.type,j=d.textMap,k=c.nodeName,l=p(g.nodeName);if(b+""!=j[f]+""){if((l?k:g.nodeValue)!==j.join("")&&c.escape)return console.warn("模板内容被修改!"),void 0;if(j[f]=b&&b+"",e=j.join(""),c.escape||"text"!==i)l||(g.nodeValue=e),"text"!==i&&(l?(k&&h.removeAttribute(k),e&&v(h,e,g.nodeValue),c.nodeName=e):v(h,k,e));else{var m,n=a.createElement("div");c.unescapeNodes=c.unescapeNodes||[],n.innerHTML=e,m=n.childNodes,c.unescapeNodes.forEach(function(a){a.parentNode&&a.parentNode.removeChild(a)}),c.unescapeNodes=[];for(var o=m.length-1;o>=0;o--)c.unescapeNodes.push(m[o]),g.parentNode.insertBefore(m[o],g);g.nodeValue=""}}}function v(a,b,c){try{b in a&&O?"style"===b&&a.style.setAttribute?a.style.setAttribute("cssText",c):a[b]="boolean"==typeof a[b]?!0:c:a.setAttribute(b,c)}catch(d){}}function w(a,b,c){for(var d=a.__ant__.$$repeaters,e=0,f=d.length;f>e;e++)d[e].type===N.REPEAT&&d[e][b](c,a);a.__ant__.$$root.$$ant.trigger("update")}function x(b,c,d,e){var f=a.createTextNode("");this.path=b.getAttribute(e),b.removeAttribute(e),this.el=b,this.vm=c,this.relativeVm=d,this.type=e,this.relateEl=f,this.els=[],e===N.IF&&i(this.el,d),this.state=this.STATE_READY,b.parentNode.insertBefore(f,b),b.parentNode.removeChild(b)}function y(){}function z(a){return"object"==typeof a&&null!==a}function A(a){return"undefined"==typeof a}function B(a){return!a||"[object Object]"!=={}.toString.call(a)||a.nodeType||a===a.window?!1:!0}function C(a,b,c){return function(){var d=b.apply(this,arguments);return c&&c.call(this,d)?d:a.apply(this,arguments)}}function D(a,b,c){return function(){var d=a.apply(this,arguments);return c&&c.call(this,d)?d:(b.apply(this,arguments),d)}}function E(a,b){return C(a,b,function(a){return a===!1})}function F(a){return a.replace(W,"").split(V)}function G(a,c,d){if(a){var e=F(a),f=d;e.forEach(function(a,b){b===e.length-1?f[a]=c:f&&f.hasOwnProperty(a)?f=f[a]:(f[a]={},f=f[a])})}else b(d,c);return d}function H(a,b){var c,d,e=b;if(a){c=F(a);for(var f=0,g=c.length;g>f;f++){if(d=c[f],!e||!e.hasOwnProperty(d))return;e=e[d]}}return e}function I(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function J(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.detachEvent("on"+b,c)}var K,L={on:function(a,b,c){var d=c||this;return d._handlers=d._handlers||{},d._handlers[a]=d._handlers[a]||[],d._handlers[a].push({handler:b,context:c,ctx:d}),this},off:function(a,b,c){var d=c||this,e=d._handlers;if(a&&e[a])if("function"==typeof b)for(var f=e[a].length-1;f>=0;f--)e[a][f].handler===b&&e[a].splice(f,1);else e[a]=[];return this},trigger:function(a){var b=this,c=[].slice.call(arguments,1),d=b._handlers;return d&&d[a]&&d[a].forEach(function(a){a.handler.apply(b,c)}),this}},M={extend:function(a,c){var d=this,e=function(){return d.apply(this,arguments)},f=function(){this.constructor=e};return f.prototype=d.prototype,e.prototype=new f,b(e.prototype,a),b(e,d,c),e}},N={};c("a-"),b(d,M,{setPrefix:c,Event:L}),b(d.prototype,L,{update:function(a,b,c){var d,e=this.vm;return z(a)?(c=b,d=b=a):"string"==typeof a?(a=F(a).join("."),A(b)&&(b=this.get(a)),d=G(a,b,{}),e=e.$$getChild(a)):b=this.data,A(c)&&(c=z(a)),f(e,b,c),this.trigger("update",d),this},render:function(a){return a&&this.set(a,{isExtend:!1,silence:!0}),f(this.vm,this.data,!1),this.isRendered=!0,this.trigger("render"),this},clone:function(a){var b=o({},this.options);return a&&a.data&&(b.data=null),new this.constructor(this.tpl,o(b,a))},get:function(a){return H(a,this.data)},set:function(a,b,c){var d,e,f,g,h;if(A(a))return this;if(z(a))d=!0,c=b,c=c||{},c.isExtend!==!1?(e=!0,o(this.data,a,this.vm)):(e=!1,this.data=o({},a,this.vm));else if(c=c||{},H(a,this.data)!==b&&(d=!0),d)if(c.isExtend!==!0){if(g=F(a),g.length>1){if(h=g.pop(),f=H(g.join("."),this.data),A(f))G(g.join("."),f={},this.data);else if(!z(f)){var i=f;G(g.join("."),f={toString:function(){return i}},this.data)}}else a?(f=this.data,h=a):(f=this,h="data");f[h]=z(b)?o(Array.isArray(b)?[]:{},b,this.vm.$$getChild(a,!Array.isArray(b))):b,e=!1}else o(this.data,G(a,b,{}),this.vm),e=!0;return d&&!c.silence&&(z(a)?this.update(a,e):this.update(a,b,e)),this},setPartial:function(c){if(c){this.partials=this.partials||{},c=b({},this.partials[c.name],c);var f,g,i,j=c.name,k=c.node,l=k&&k.parentNode,m=c.content,n=c.path||"";if(j&&(this.partials[j]=c),m){if(i=this.vm.$$getChild(n),m instanceof d)f=[m.el];else if(c.escape&&!z(m))f=[a.createTextNode(m)];else{g=e(m,"div").el.childNodes,f=[];for(var o=0,p=g.length;p>o;o++)f.push(g[o])}for(var o=0,p=f.length;p>o;o++)l&&l.insertBefore(f[o],k);h(f,i),this.isRendered&&i.$$render(H(n,this.data))}return this}},parse:function(a){return a},init:y,watch:function(){},unwatch:function(){}});var O=!!a.attachEvent;m.prototype={$$watchers:null,$$root:null,$$parent:null,$$repeaters:null,$$ant:null,$$path:null,_watchers:null,$$getChild:function(a,b){var c,d,e,f=this;if(a+=""){e=a.split(/(?!^)\.(?!$)/);for(var g=0,h=e.length;h>g;g++){if(c=e[g],!f[c]){if(b)return null;d=new m,d.$$parent=f,d.$$root=f.$$root||f,d.$$path=c,f[c]=d}f=f[c]}}return f},$$getKeyPath:function(){for(var a=this.$$path,b=this;(b=b.$$parent)&&b.$$path;)a=b.$$path+"."+a;return a},$$getData:function(a,b){var c=H(a,this.$$root.$$ant.get(this.$$getKeyPath()));return!b&&this.$$parent&&A(c)?this.$$parent.$$getData(a):c},$$render:function(a,b){var c,d,e=b?a:this;this.$$repeaters.forEach(function(c){c.generate(a,b)});for(var f=0,g=this.$$watchers.length;g>f;f++)this.$$watchers[f].call(this,a);for(var f=0,g=this._watchers.length;g>f;f++)c=this._watchers[f],d=c.getValue(this),c.value!==d&&(c.fn.call(this,d,c.value),c.value=d,c.state=t.STATE_CALLED);if(z(e))for(var h in e)!this.hasOwnProperty(h)||h in m.prototype||this[h].$$render(a?a[h]:void 0,b)}};var P=/{{({([^{}\n]+)}|[^{}\n]+)}}/g,Q=function(a,b,c){var d="."===b.path?a:a.$$getChild(b.path),e=function(d){var e=A(d)?a.$$getData(b.path):d;u(e,b,c)};e.el=b.el,d.$$watchers.push(e)},R=/^\^/;Q=E(Q,function(a,b,c){var d=b.path,e=d.split(":"),f=function(){var d=a.$$getData(h),e=(R.test(g)?!d:d)?i:"";u(e,b,c)};if(2===e.length){var g=e[0].trim(),h=g.replace(R,""),i=e[1].trim();return f.el=b.el,a.$$getChild(h).$$watchers.push(f),!1}});var S=/^>\s*(?=.+)/;Q=E(Q,function(b,c){var d,e,f,g;return"text"===c.type&&S.test(c.path)?(d=c.path.replace(S,""),e=b.$$root.$$ant,f=e.options,g=a.createTextNode(""),c.el.insertBefore(g,c.node),c.el.removeChild(c.node),e.setPartial({name:d,content:f&&f.partials&&f.partials[d],node:g,escape:c.escape,path:b.$$getKeyPath()}),!1):void 0}),Q=E(Q,function(a,b){var c,d=b.nodeName,e=b.path;switch(d){case N.IF:e=e.replace(R,"");case N.REPEAT:return c=a.$$getChild(e),c.$$repeaters.push(new x(b.el,c,a,d)),!1}});var T=[function(a,b){"."===b.path?a:a.$$getChild(b.path),watcher=new watcher(a,b,function(){}),watcher.addKey(b.path)}];b(t,{STATE_READY:0,STATE_CALLED:1},M),b(t.prototype,{getValue:function(){},addKey:function(a){this.keys.push(a)}});var U={splice:D([].splice,function(){w(this,"splice",[].slice.call(arguments))}),push:D([].push,function(){var a=[].slice.call(arguments);a.unshift(this.length-a.length,0),w(this,"splice",a)}),pop:D([].pop,function(){w(this,"splice",[this.length,1])}),shift:D([].shift,function(){w(this,"splice",[0,1])}),unshift:D([].unshift,function(){var a=[].slice.call(arguments);a.unshift(0,0),w(this,"splice",a)}),sort:D([].sort,function(){w(this,"sort")}),reverse:D([].reverse,function(){w(this,"reverse")})};b(x,{isGenTempl:function(a){return a&&a.hasAttributes&&a.hasAttributes(N.REPEAT)||a.hasAttributes(N.IF)}}),x.prototype={STATE_READY:0,STATE_GENEND:1,generate:function(a,b){var c=this,a=this.relativeVm.$$getData(this.path.replace(R,""));if(c.type===N.REPEAT){if(a&&!Array.isArray(a))return console.warn("需要一个数组"),void 0;0!==this.state&&b||a&&this.splice([0,this.els.length].concat(a))}else R.test(this.path)&&(a=!a),a?c.lastIfState||c.relateEl.parentNode.insertBefore(c.el,c.relateEl):c.lastIfState&&c.el.parentNode.removeChild(c.el),c.lastIfState=a;c.state=this.STATE_GENEND},splice:function(b,c){var d,e,f=this.els,g=b.slice(2),h=1*b[0],j=1*b[1],k=g.length,l=[],m=a.createDocumentFragment(),p=this.relateEl.parentNode;A(j)&&(b[1]=j=f.length-h);for(var q=h,r=f.length;r>q;q++)if(h+j>q)try{p.removeChild(f[q])}catch(s){}else{if(!k&&!j)break;f[q][K+"index"]=q-j+k,e=this.vm[q-j+k]=this.vm[q],e.$$path=q-j+k+""}for(var t=0;k>t;t++)d=this.el.cloneNode(!0),e=this.vm.$$getChild(h+t),n(e,f[h+t]),d[K+"index"]=h+t,m.appendChild(d),i(d,e),e.$$render(g[t]),l.push(d),c&&z(c[h+t])&&(c[h+t]=o(Array.isArray(c[h+t])?[]:{},c[h+t],e));l.length&&p.insertBefore(m,f[h+j]||this.relateEl);for(var u=r-j+k;r>u;u++)delete this.vm[u];b=b.slice(0,2).concat(l),f.splice.apply(f,b),j!==k&&this.vm.$$getChild("length").$$render(f.length)},reverse:function(){for(var b,c=this.vm,d=this.relateEl,e=a.createDocumentFragment(),f=0,g=this.els.length;g>f;f++).5>f&&(b=c[f],c[f]=c[g-f-1],c[f].$$path=f+"",b.$$path=g-f-1+"",c[g-f-1]=b),this.els[f][K+"index"]=g-f-1,e.appendChild(this.els[g-f-1]);d.parentNode.insertBefore(e,d),this.els.reverse()},sort:function(){this.generate()}};var V=/(?:\.|\[)/g,W=/\]/g;return d});