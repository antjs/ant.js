/*! ant.js 2013-08-03 06:41 */
!function(a,b){"object"==typeof module&&module?module.exports=b():("function"==typeof define&&define(b),a.Ant=b())}(this,function(){"use strict";function a(b){var c,d,e,f,g=arguments.length;b=b||{};for(var h=1;g>h;h++)if(null!==(c=arguments[h]))for(var i in c)d=b[i],e=c[i],b!==e&&"__ant__"!==i&&(q(e)?(f=Array.isArray(e)?d&&Array.isArray(d)?d:[]:d||{},b[i]=a(f,e)):b[i]=e);return b}function b(a){a&&(z=a,A=z+"if",B=z+"repeat",C=z+"model")}function c(a,b){b=b||{};var c,e=b.data||{},g=b.events||{};c=f(a),a=c.tpl,c=c.el,e=this.parse(e,b),this.tpl=a,this.el=c,this.data=e,this.isRendered=!1,this.addBinding=I,"function"==typeof b.addBinding&&(this.addBinding=u(I,b.addBinding)),this.isLazy=!!b.lazy,this.partials=b.partials||{},this.options=b,h(this);for(var i in g)this.on(i,g[i]);b.data&&(d(e,this),this.render()),this.init.apply(this,arguments)}function d(a,b){function c(a){var d;for(var f in a)d=a[f],"object"==typeof d&&"__ant__"!==f&&(Array.isArray(d)&&(d.__ant__=b,e(d,b)),c(d))}c(a)}function e(a){for(var b in G)a[b]=G[b]}function f(a){var b,c=document.createElement("div");return q(a)?(b=a,a=c.outerHTML):(c.innerHTML=a.trim(),b=c.firstChild),{el:b,tpl:a}}function g(a,b,c){a.vm.$$render(b,c),1>=c&&(a.isRendered=!0)}function h(a){var b=new k;b.$$root=b,b.$$ant=a,a.vm=b,i(a.el,b)}function i(a,b){if(8!==a.nodeType){var c,d,e=a.getAttribute(B),f=a.getAttribute(A),g=a.getAttribute(C);if(e?(b.$$getChild(e).$$addGenerator(a,b.$$getChild(e),o.TYPE_REPEAT),c=!0):f?(f=f.replace(J,""),b.$$getChild(f).$$addGenerator(a,b.$$getChild(f),o.TYPE_IF),c=!0):g&&j(a,g,b),!c){for(var f=0,h=a.attributes.length;h>f;f++)l(a.attributes[f].nodeName)||b.$$updateVM(a.attributes[f],a);for(var k=a.firstChild;k;)d=k.nextSibling,3===k.nodeType?b.$$updateVM(k,k.parentNode):i(k,b),k=d}}}function j(a,b,c){var d,e=c.$$root.$$ant,f=c.$$getChild(b),g="change",h=d="value",i=r(e.get(f.$$keyPath)),j=/\r\n/g,k=function(b,c){var e=b.$$getData(c)||"",f=a[d];f.replace&&(f=f.replace(j,"\n")),e!==f&&(a[d]=e)},m=function(){var b=a[h];b.replace&&(b=b.replace(j,"\n")),e.set(f.$$keyPath,b)};switch(a.tagName){case"INPUT":case"TEXTAREA":switch(a.type){case"checkbox":h=d="checked",a.attachEvent&&(g+=" click");break;case"radio":d="checked",a.attachEvent&&(g+=" click"),k=function(b,c){a.checked=a.value===b.$$getData(c)},i=a.checked;break;default:e.isLazy||("oninput"in a&&(g+=" input"),a.attachEvent&&(g+=" keyup propertychange cut"))}break;case"SELECT":a.multiple&&(m=function(){for(var b=[],c=0,d=a.options.length;d>c;c++)a.options[c].selected&&b.push(a.options[c].value);e.set(f.$$keyPath,b)},k=function(b,c){for(var d=b.$$getData(c),e=0,f=a.options.length;f>e;e++)a.options[e].selected=d&&-1!==d.indexOf(a.options[e].value)}),i=i&&!l(a[h])}f.$$watchers.push(k),g.split(/\s+/g).forEach(function(b){y(a,b,m),x(a,b,m)}),a.removeAttribute(C),a[h]&&i&&m()}function k(){this.$$keyPath="",this.$$watchers=[]}function l(a){return a&&H.test(a)}function m(a,b){var c,d,e,f,g=[],h=[],i=0,j=a.nodeValue;if(3===a.nodeType)d="text";else{if(2!==a.nodeType)return console.error("我们需要一个文本节点或者属性节点"),void 0;d="attr",e=a.nodeName,0===(f=e.indexOf(z))&&(e=a.nodeName.slice(z.length))}for(H.lastIndex=0;c=H.exec(j);)H.lastIndex-i>c[0].length&&h.push(j.slice(i,H.lastIndex-c[0].length)),g.push({escape:!c[2],path:(c[2]||c[1]).trim(),position:h.length}),h.push(c[0]),i=H.lastIndex;return j.length>i&&h.push(j.slice(i,j.length)),{tokens:g,textMap:h,node:a,type:d,refNodeName:e,el:b}}function n(a,b,c){var d=b.position,e=c.node,f=c.textMap,g=c.refNodeName;if(a+""!=f[d]+""){if(e.nodeValue!==f.join("")&&b.escape)return console.warn("没有更新内容. 因为模板内容已被其他程序修改!"),void 0;if(f[d]=a&&a+"",b.escape||"text"!==c.type)e.nodeValue=f.join(""),g&&"attr"===c.type&&("style"===g&&c.el.style.setAttribute?c.el.style.setAttribute("cssText",e.nodeValue):c.el.setAttribute(c.refNodeName,e.nodeValue));else{var h,i=document.createElement("div");b.unescapeNodes=b.unescapeNodes||[],i.innerHTML=f.join(""),h=i.childNodes,b.unescapeNodes.forEach(function(a){a.parentNode&&a.parentNode.removeChild(a)}),b.unescapeNodes=[];for(var j=0,k=h.length;k>j;j++)b.unescapeNodes.push(h[j]),e.parentNode.insertBefore(h[j],e),j--,k--;e.nodeValue=""}}}function o(a,b,c){for(var d,e=a,f=c===o.TYPE_IF?A:B;;){if(e=e.nextSibling,e&&e.hasAttributes){if(o.isGenTempl(e))continue;d="sibling";break}e=a.parentNode,d="parent";break}this.path=a.getAttribute(f),a.removeAttribute(f),f===A&&i(a,b.$$parent),this.el=a,this.vm=b,this.type=c,this.relateEl=e,this.relateType=d,this.instances=[],this.state=this.STATE_READY,a.parentNode&&a.parentNode.removeChild(a)}function p(){}function q(a){return"object"==typeof a&&null!==a}function r(a){return"undefined"==typeof a}function s(a,b,c){return function(){var d=b.apply(this,arguments);return c&&c.call(this,d)?d:a.apply(this,arguments)}}function t(a,b,c){return function(){var d=a.apply(this,arguments);return c&&c.call(this,d)?d:(b.apply(this,arguments),d)}}function u(a,b){return s(a,b,function(a){return a===!1})}function v(a,b,c){var d=a.replace(M,"").split(L),e=c;return d.forEach(function(a,c){c===d.length-1?e[a]=b:e&&e.hasOwnProperty(a)?e=e[a]:(e[a]=d[c+1]&&/^\d+$/.test(d[c+1])?[]:{},e=e[a])}),c}function w(a,b){for(var c,d=a.replace(M,"").split(L),e=b,f=0,g=d.length;g>f;f++){if(c=d[f],!e||!e.hasOwnProperty(c))return;e=e[c]}return e}function x(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function y(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.detachEvent("on"+b,c)}var z,A,B,C,D={on:function(a,b,c){var d=c||this;return d._handlers=d._handlers||{},d._handlers[a]=d._handlers[a]||[],d._handlers[a].push({handler:b,context:c,ctx:d}),this},off:function(a,b,c){var d=c||this,e=d._handlers;if(a&&e[a])if("function"==typeof b)for(var f=0;f<e[a].length;f++)e[a][f].handler===b&&(e[a].splice(f,1),f--);else e[a]=[];return this},trigger:function(a){var b=this,c=[].slice.call(arguments,1),d=b._handlers;return d&&d[a]&&d[a].forEach(function(a){a.handler.apply(b,c)}),this}},E={extend:function(b,c){var d=this,e=function(){return d.apply(this,arguments)},f=function(){this.constructor=e};return f.prototype=d.prototype,e.prototype=new f,a(e.prototype,b),a(e,d,c),e}},F={RENDER:0,RESET:1,EXTEND:2,ARRAY_REPLACE:3};b("a-"),a(c,E,{RENDER_TYPE:F,setPrefix:b,Event:D}),a(c.prototype,D,{update:function(a,b,c){var d;q(a)?(c=b,b=a):"string"==typeof a&&r(b)&&(b=v(a,d=this.get(a),{}),c=Array.isArray(d)?F.ARRAY_REPLACE:F.EXTEND),r(c)&&(c=F.EXTEND),g(this,b||this.data,c),this.trigger("update",b)},render:function(a){g(this,a||this.data,F.RENDER),this.trigger("render")},reset:function(a){this.set(a,{type:F.RESET}),this.trigger("reset")},clone:function(b){return new this.constructor(this.tpl,a(this.options,b))},get:function(a){return w(a,this.data)},set:function(b,c,e){var f,g,h,i={};if(!b)return this;if(q(b)){e=c,e=e||{},i=this.parse(b,e),b="";for(var j in i)this.data[j]!==i[j]&&(this.data[j]=i[j],e.silence||(f=!0,h=e.type))}else e=e||{},g=w(b,this.data),v(b,c,i),c=w(b,i),i=this.parse(i,e),e.silence||g===c||(a(this.data,i),f=!0,h=r(e.type)?Array.isArray(g)?F.ARRAY_REPLACE:F.EXTEND:opts.type);d(i,this),f&&this.update(i,h)},_virtual:function(){},parse:function(a){return a},init:p});var G={splice:t([].splice,function(){this.__ant__.update(null,null,3)}),push:t([].push,function(){this.__ant__.update(null,null,3)}),pop:t([].pop,function(){this.__ant__.update(null,null,3)}),sort:t([].sort,function(){this.__ant__.update(null,null,3)}),reverse:t([].reverse,function(){this.__ant__.update(null,null,3)}),unshift:t([].unshift,function(){this.__ant__.update(null,null,3)}),shift:t([].shift,function(){this.__ant__.update(null,null,3)})};k.prototype={$$watchers:null,$$root:null,$$parent:null,$$generators:null,$$ant:null,$$data:null,$$keyPath:null,$$updateVM:function(a,b){l(a.nodeValue)&&this.$$addWatcher(a,b)},$$getChild:function(a){var b,c,d,e=this;d=a.split(/(?!^)\.(?!$)/);for(var f=0,g=d.length;g>f;f++)b=d[f],e[b]||(c=new k,c.$$parent=e,c.$$root=e.$$root||e,c.$$keyPath=e.$$keyPath+(e.$$keyPath&&".")+b,e[b]=c),e=e[b];return e},$$addWatcher:function(a,b){var c=m(a,b),d=c.tokens,e=c.textMap,f=this;"text"===c.type&&e.length>1?(e.forEach(function(c){var d=document.createTextNode(c);b.insertBefore(d,a),f.$$updateVM(d,b)}),b.removeChild(a)):d.forEach(function(a){I(c,f,a)})},$$addGenerator:function(a,b,c){this.$$generators=this.$$generators||[];var d=new o(a,b,c);return this.$$generators.push(d),d},$$getData:function(a,b){if(b)return this.$$data[a];for(var c=this;c;c=c.$$parent)if(c.$$data&&!r(c.$$data[a]))return c.$$data[a]},$$render:function(a,b){var c,d=this;d.$$data=a;for(var e in d)if(!(!d.hasOwnProperty(e)||e in k.prototype||b>=F.EXTEND&&q(a)&&!(e in a))){if(c=d.$$getChild(e),c.$$generators&&c.$$generators.length)for(var f=0,g=c.$$generators.length;g>f;f++)(c.$$generators[f].type==o.TYPE_IF||0===c.$$generators[f].state||b!==F.EXTEND)&&c.$$generators[f].generate(a,e);if(d[e].$$watchers.length)for(var f=0,g=c.$$watchers.length;g>f;f++)c.$$watchers[f](d,e);(!r(a[e])||b<F.EXTEND)&&c.$$render(r(a[e])?{}:a[e],b)}}};var H=/{{({([^{}\n]+)}|[^{}\n]+)}}/g,I=function(a,b,c){var d=b.$$getChild(c.path);d.$$watchers.push(function(b,d){var e="."===d?b.$$data:b.$$getData(d);n(e,c,a)})},J=/^\^/;I=u(I,function(a,b,c){var d=c.path,e=d.split(":");if(2===e.length){var f=e[0].trim(),g=e[1].trim();return b.$$getChild(f.replace(J,"")).$$watchers.push(function(b,d){var e=b.$$getData(d),h=(J.test(f)?!e:e)?g:"";n(h,c,a)}),!1}});var K=/^>\s*(?=.+)/;I=u(I,function(a,b,d){var e,g,h,j,k=a.node.parentNode;return"text"===a.type&&K.test(d.path)?(e=d.path.replace(K,""),h=b.$$root.$$ant,(g=h.partials[e])&&(j=g instanceof c?g.el:f(g).el,i(j,b),k.insertBefore(j,a.node)),k.removeChild(a.node),!1):void 0}),a(o,{TYPE_REPEAT:"repeat",TYPE_IF:"if",isGenTempl:function(a){return a&&a.hasAttributes&&a.hasAttributes(B)||a.hasAttributes(A)}}),o.prototype={STATE_READY:0,STATE_GENEND:1,generate:function(a,b){var c=this,d=document.createDocumentFragment(),e=a[b];if(c.type===o.TYPE_REPEAT){if(e&&!Array.isArray(e))return console.warn(JSON.stringify(e)+" 应该是一个数组"),void 0;c.empty(),e&&e.forEach(function(a,b){var e=c.el.cloneNode(!0),f=c.vm.$$getChild(b+"");d.appendChild(e),i(e,f),f.$$render(a),c.instances.push(e)})}else J.test(this.path)&&(e=!e),e?c.lastIfState||d.appendChild(c.el):c.lastIfState&&c.el.parentNode.removeChild(c.el),c.lastIfState=e;"sibling"===c.relateType?c.relateEl.parentNode.insertBefore(d,c.relateEl):c.relateEl.appendChild(d),c.state=this.STATE_GENEND},splice:function(){},empty:function(){var a=this;this.instances.forEach(function(b,c){b.parentNode&&11!==b.parentNode.nodeType&&b.parentNode.removeChild(b),delete a.vm[c]}),this.instances=[]}};var L=/(?:\.|\[)/g,M=/\]/g;return c});