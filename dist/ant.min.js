/*! ant.js 2013-10-24 08:23 */
Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;++c)c in this&&a.call(b,this[c],c,this)}),Array.isArray||(Array.isArray=function(a){return"[object Array]"==={}.toString.call(a)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0;c<this.length;c++)if(this[c]===a)return c;return-1}),function(a){var b=this;if("object"==typeof module&&module){var c=b.document||require("jsdom").jsdom();module.exports=a(c)}else a=a(b.document),"function"==typeof define&&define(function(){return a}),b.Ant=a}(function(a){"use strict";function b(a){var b,c=arguments.length;a=a||{};for(var d=1;c>d;d++)if(null!==(b=arguments[d]))for(var e in b)a[e]=b[e];return a}function c(a){a&&(E=a,H.IF=E+"if",H.REPEAT=E+"repeat",H.MODEL=E+"model",d.PREFIX=E)}function d(a,c){c=c||{};var d,g=c.data||{},h=c.events||{};d=e(a,c.el),a=d.tpl,d=d.el,this.tpl=a,this.el=d,this.data={},this.isRendered=!1,this.isLazy=!!c.lazy,this.options=c,this.partials=null,this.bindings=(this.bindings||[]).concat(c.bindings||[]);for(var i in h)this.on(i,h[i]);this.trigger("beforeInit"),f(this),this.trigger("build"),g=b(this.data,g),c.data&&this.render(g),this.init.apply(this,arguments),this.trigger("afterInit")}function e(b,c){var d;return u(b)?(c?(d=c=u(c)?c:a.createElement(c),d.innerHTML="",c.appendChild(b)):d=b,b=d.outerHTML):(d=u(c)?c:a.createElement(c||"div"),d.innerHTML=b),{el:d,tpl:b}}function f(a){var b=new k;b.$$root=b,b.$$ant=a,a.vm=b,g(a.el,b)}function g(a,b){if(a.nodeType&&!a.length)h(a,b);else for(var c=0,d=a.length;d>c;c++)h(a[c],b)}function h(a,b){if(8!==a.nodeType){if(3===a.nodeType)return j(b,a,a.parentNode),void 0;if(!i(a,b))for(var c,d=a.firstChild;d;)c=d.nextSibling,h(d,b),d=c}}function i(a,b){var c,d=a.getAttributeNode(H.REPEAT),e=a.getAttributeNode(H.IF),f=a.getAttributeNode(H.MODEL),g=d||e;if(g)return j(b,g,a,!0),!0;f&&j(b,f,a,!0);for(var h=a.attributes.length-1;h>=0;h--)c=a.attributes[h],j(b,c,a),0===c.nodeName.indexOf(E)&&a.removeAttribute(c.nodeName)}function j(b,c,d,e){if(e||m(c.nodeValue)||m(c.nodeName)){var f=n(c,d,e),g=f.textMap;"text"===f.type&&g.length>1?(g.forEach(function(e){var f=a.createTextNode(e);d.insertBefore(f,c),j(b,f,d)}),d.removeChild(c)):f.forEach(function(a){o(b,a,f)})}}function k(){this.$$path="",this.$watchers=[]}function l(a,b,c){var d,e,f;for(var g in b)d=a[g],e=b[g],a!==e&&"__ant__"!==g&&(w(e)||Array.isArray(e)?(f=Array.isArray(e)?d&&Array.isArray(d)?d:[]:d||{},a[g]=l(f,e,c&&c.$$getChild(g))):a[g]=e);return c&&Array.isArray(a)&&(a.__ant__=c,a.push!==N.push&&l(a,N)),a}function m(a){return J.lastIndex=0,a&&J.test(a)}function n(a,b,c){var d,e,f=[],g=[],h=0,i=a.nodeValue,j=a.nodeName;for(c?f.push({nodeName:j,path:i,el:b,node:a}):3===a.nodeType?e="text":2===a.nodeType&&(e="attr",0===j.indexOf(E)&&(j=a.nodeName.slice(E.length)),m(j)&&(i=j)),J.lastIndex=0;d=J.exec(i);)J.lastIndex-h>d[0].length&&g.push(i.slice(h,J.lastIndex-d[0].length)),f.push({escape:!d[2],path:(d[2]||d[1]).trim(),position:g.length,el:b,node:a,nodeName:j,type:e,textMap:g}),g.push(d[0]),h=J.lastIndex;return i.length>h&&g.push(i.slice(h,i.length)),f.type=e,f.textMap=g,f}function o(a,b){var c=p(a.$$root.$$ant.bindings),d=c(a,b);d&&d.vm.$watchers.push(d)}function p(a){a=M.concat(a);for(var b=a[0],c=1,d=a.length;d>c;c++)b=x(b,a[c],function(a){return a instanceof q||a===!1});return b}function q(a,b,c,d){this.token=c,this.relativeVm=b,this.vm=a,this.val=null,this.fn=function(a){for(var c,e={},f=0,g=this.keys.length;g>f;f++)c=this.keys[f],e[c]=b.$$getData("."===c?"":c);var h=d(e);if(h!==this.val)try{this.update(h,a),this.val=h}catch(i){console.warn(i)}this.state=q.STATE_CALLED},this.keys=[],this.el=c.el,this.state=q.STATE_READY}function r(a,b,c){try{(b in a||"class"===b)&&I?"style"===b&&a.style.setAttribute?a.style.setAttribute("cssText",c):"class"===b?a.className=c:a[b]="boolean"==typeof a[b]?!0:c:a.setAttribute(b,c)}catch(d){}}function s(a,b,c){for(var d=a.__ant__.$watchers,e=!1,f=0,g=d.length;g>f;f++)d[f].type===H.REPEAT&&(d[f][b](c,a,e),e=!0);a.__ant__.$$root.$$ant.trigger("update")}function t(){}function u(a){return"object"==typeof a&&null!==a}function v(a){return"undefined"==typeof a}function w(a){return!a||"[object Object]"!=={}.toString.call(a)||a.nodeType||a===a.window?!1:!0}function x(a,b,c){return function(){var d=b.apply(this,arguments);return c&&c.call(this,d)?d:a.apply(this,arguments)}}function y(a,b,c){return function(){var d=a.apply(this,arguments);return c&&c.call(this,d)?d:(b.apply(this,arguments),d)}}function z(a){return a.replace(Q,"").split(P)}function A(a,c,d){if(a){var e=z(a),f=d;e.forEach(function(a,b){b===e.length-1?f[a]=c:f&&f.hasOwnProperty(a)?f=f[a]:(f[a]={},f=f[a])})}else b(d,c);return d}function B(a,b){var c,d,e=b;if(a){c=z(a);for(var f=0,g=c.length;g>f;f++){if(d=c[f],!e||!e.hasOwnProperty(d))return;e=e[d]}}return e}function C(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function D(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.detachEvent("on"+b,c)}var E,F={on:function(a,b,c){var d=c||this;return d._handlers=d._handlers||{},d._handlers[a]=d._handlers[a]||[],d._handlers[a].push({handler:b,context:c,ctx:d}),this},off:function(a,b,c){var d=c||this,e=d._handlers;if(a&&e[a])if("function"==typeof b)for(var f=e[a].length-1;f>=0;f--)e[a][f].handler===b&&e[a].splice(f,1);else e[a]=[];return this},trigger:function(a){var b=this,c=[].slice.call(arguments,1),d=b._handlers;return d&&d[a]&&d[a].forEach(function(a){a.handler.apply(b,c)}),this}},G={extend:function(a,c,d){"function"==typeof c&&(d=c,c={}),"function"==typeof a&&(d=a,a={});var e=this;d=d||function(){return e.apply(this,arguments)};var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,b(d.prototype,a,{__super__:e}),b(d,e,c),d}},H={};c("a-"),b(d,G,{setPrefix:c,Event:F,doc:a}),b(d.prototype,F,{update:function(a,b,c){var d,e=this.vm;return u(a)?(c=b,d=b=a):"string"==typeof a?(a=z(a).join("."),v(b)&&(b=this.get(a)),d=A(a,b,{}),e=e.$$getChild(a)):b=this.data,v(c)&&(c=u(a)),e.$$render(b,c),this.trigger("update",d),this},render:function(a){return a&&this.set(a,{isExtend:!1,silence:!0}),this.vm.$$render(this.data,!1),this.isRendered=!0,this.trigger("render"),this},clone:function(a){var b=l({},this.options);return a&&a.data&&(b.data=null),new this.constructor(this.tpl,l(b,a))},get:function(a){return B(a,this.data)},set:function(a,b,c){var d,e,f,g,h;if(v(a))return this;if(u(a))d=!0,c=b,c=c||{},c.isExtend!==!1?(e=!0,l(this.data,a,this.vm)):(e=!1,this.data=l({},a,this.vm));else if(c=c||{},B(a,this.data)!==b&&(d=!0),d)if(c.isExtend!==!0){if(g=z(a),g.length>1){if(h=g.pop(),f=B(g.join("."),this.data),v(f))A(g.join("."),f={},this.data);else if(!u(f)){var i=f;A(g.join("."),f={toString:function(){return i}},this.data)}}else a?(f=this.data,h=a):(f=this,h="data");f[h]=u(b)?l(Array.isArray(b)?[]:{},b,this.vm.$$getChild(a,!Array.isArray(b))):b,e=!1}else l(this.data,A(a,b,{}),this.vm),e=!0;return d&&!c.silence&&(u(a)?this.update(a,e):this.update(a,b,e)),this},setPartial:function(c){if(c){this.partials=this.partials||{},c=b({},this.partials[c.name],c);var f,h,i,j=c.name,k=c.node,l=k&&k.parentNode,m=c.content,n=c.path||"";if(j&&(this.partials[j]=c),m){if(i=this.vm.$$getChild(n),m instanceof d)f=[m.el];else if(c.escape&&!u(m))f=[a.createTextNode(m)];else{h=e(m,"div").el.childNodes,f=[];for(var o=0,p=h.length;p>o;o++)f.push(h[o])}for(var o=0,p=f.length;p>o;o++)l&&l.insertBefore(f[o],k);g(f,i),this.isRendered&&i.$$render(B(n,this.data))}return this}},parse:function(a){return a},init:t,watch:function(a,b){var c=this,d=this.vm.$$getChild(a),e=new q(d,d,{},function(b){return b[a]});e.addKey(a),e.callback=b,e.update=function(a){b.call(c,a,c.val),c.val=a},d.$watchers.push(e)},unwatch:function(){}});var I=!!a.attachEvent;k.prototype={$$root:null,$$parent:null,$$ant:null,$$path:null,$watchers:null,$$getChild:function(a,b){var c,d,e,f=this;if(a+=""){e=a.split(/(?!^)\.(?!$)/);for(var g=0,h=e.length;h>g;g++){if(c=e[g],!f[c]){if(b)return null;d=new k,d.$$parent=f,d.$$root=f.$$root||f,d.$$path=c,f[c]=d}f=f[c]}}return f},$$getKeyPath:function(){for(var a=this.$$path,b=this;(b=b.$$parent)&&b.$$path;)a=b.$$path+"."+a;return a},$$getData:function(a,b){var c=B(a,this.$$root.$$ant.get(this.$$getKeyPath()));return!b&&this.$$parent&&v(c)?this.$$parent.$$getData(a):c},$$render:function(a,b){for(var c=b?a:this,d=0,e=this.$watchers.length;e>d;d++)this.$watchers[d].fn(b);if(u(c))for(var f in c)!this.hasOwnProperty(f)||f in k.prototype||this[f].$$render(a?a[f]:void 0,b)}};var J=/{{({([^{}\n]+)}|[^{}\n]+)}}/g,K=/^\^/,L=/^>\s*(?=.+)/,M=[function(a,b){var c="."===b.path?a:a.$$getChild(b.path),d=new q(c,a,b,function(a){return a[b.path]});return d.addKey(b.path),d},function(a,b){var c=b.path,d=c.split(":");if(2===d.length){var e=d[0].trim(),f=e.replace(K,""),g=d[1].trim(),h=new q(a.$$getChild(f),a,b,function(a){var b=a[f];return(K.test(e)?!b:b)?g:""});return h.addKey(f),h}},function(b,c){var d,e,f,g;return"text"===c.type&&L.test(c.path)?(d=c.path.replace(L,""),e=b.$$root.$$ant,f=e.options,g=a.createTextNode(""),c.el.insertBefore(g,c.node),c.el.removeChild(c.node),e.setPartial({name:d,content:f&&f.partials&&f.partials[d],node:g,escape:c.escape,path:b.$$getKeyPath()}),!1):void 0},function(a,b){var c,d=b.nodeName,e=b.path;switch(d){case H.IF:e=e.replace(K,"");case H.REPEAT:c=a.$$getChild(e);var f=new O(c,a,b,function(a){return a[e]});return f.addKey(e),f}},function(a,b){var c=b.path,d=b.el;if(b.nodeName===H.MODEL){if(!c)return!1;var e,f=a.$$root.$$ant,g="."===c?a:a.$$getChild(c),h="change",i=e="value",j=v(f.get(g.$$getKeyPath())),k=/\r\n/g,l=function(b){var f=b||a.$$getData(c)||"",b=d[e];b&&b.replace&&(b=b.replace(k,"\n")),f!==b&&(d[e]=f)},n=function(){var a=d[i];a.replace&&(a=a.replace(k,"\n")),f.set(g.$$getKeyPath(),a)};switch(d.tagName){default:i=e="innerHTML",h+=" blur";case"INPUT":case"TEXTAREA":switch(d.type){case"checkbox":i=e="checked",I&&(h+=" click");break;case"radio":e="checked",I&&(h+=" click"),l=function(){d.checked=d.value===a.$$getData(c)},j=d.checked;break;default:f.isLazy||("oninput"in d&&(h+=" input"),I&&(h+=" keyup propertychange cut"))}break;case"SELECT":d.multiple&&(n=function(){for(var a=[],b=0,c=d.options.length;c>b;b++)d.options[b].selected&&a.push(d.options[b].value);f.set(g.$$getKeyPath(),a)},l=function(){var b=a.$$getData(c);if(b&&b.length)for(var e=0,f=d.options.length;f>e;e++)d.options[e].selected=-1!==b.indexOf(d.options[e].value)}),j=j&&!m(d[i])}h.split(/\s+/g).forEach(function(a){D(d,a,n),C(d,a,n)}),d.removeAttribute(H.MODEL);var o=new q(a,g,b,function(a){return a[c]});return o.update=l,o.addKey(c),d[i]&&j&&n(),o}}];b(q,{STATE_READY:0,STATE_CALLED:1},G),b(q.prototype,{addKey:function(a){this.keys.push(a)},update:function(b){var c,d=this.token,e=d.position,f=d.node,g=d.el,h=d.type,i=d.textMap,j=d.nodeName,k=m(f.nodeName);if(b+""!=i[e]+""){if((k?j:f.nodeValue)!==i.join("")&&d.escape)return console.warn("模板内容被修改!"),void 0;if(i[e]=b&&b+"",c=i.join(""),d.escape||"text"!==h)k||(f.nodeValue=c),"text"!==h&&(k?(j&&g.removeAttribute(j),c&&r(g,c,f.nodeValue),d.nodeName=c):r(g,j,c));else{var l,n=a.createElement("div");d.unescapeNodes=d.unescapeNodes||[],n.innerHTML=c,l=n.childNodes,d.unescapeNodes.forEach(function(a){a.parentNode&&a.parentNode.removeChild(a)}),d.unescapeNodes=[];for(var o=l.length-1;o>=0;o--)d.unescapeNodes.push(l[o]),f.parentNode.insertBefore(l[o],f);f.nodeValue=""}}}});var N={splice:y([].splice,function(){s(this,"splice",[].slice.call(arguments))}),push:y([].push,function(){var a=[].slice.call(arguments);a.unshift(this.length-a.length,0),s(this,"splice",a)}),pop:y([].pop,function(){s(this,"splice",[this.length,1])}),shift:y([].shift,function(){s(this,"splice",[0,1])}),unshift:y([].unshift,function(){var a=[].slice.call(arguments);a.unshift(0,0),s(this,"splice",a)}),sort:y([].sort,function(){s(this,"sort")}),reverse:y([].reverse,function(){s(this,"reverse")})},O=q.extend({update:function(a,b){var c=this,a=this.relativeVm.$$getData(this.path.replace(K,""));if(c.type===H.REPEAT){if(a&&!Array.isArray(a))return console.warn("需要一个数组"),void 0;0!==this.state&&b||a&&this.splice([0,this.els.length].concat(a))}else K.test(this.path)&&(a=!a),a?c.lastIfState||c.relateEl.parentNode.insertBefore(c.el,c.relateEl):c.lastIfState&&c.el.parentNode.removeChild(c.el),c.lastIfState=a},splice:function(b,c,d){var e,f,g=this.els,i=b.slice(2),j=1*b[0],k=1*b[1],m=i.length,n=[],o=a.createDocumentFragment(),p=this.relateEl.parentNode;v(k)&&(b[1]=k=g.length-j);for(var q=j,r=g.length;r>q;q++)if(j+k>q){try{p.removeChild(g[q])}catch(s){}d||delete this.vm[q]}else{if(!k&&!m)break;var t=q-(k-m);g[q][E+"index"]=t,d||(f=this.vm[t]=this.vm[q],f.$$path=t+"")}for(var t=0;m>t;t++)e=this.el.cloneNode(!0),d||delete this.vm[j+t],f=this.vm.$$getChild(j+t),e[E+"index"]=j+t,o.appendChild(e),h(e,f),f.$$render(i[t]),n.push(e),c&&u(c[j+t])&&(c[j+t]=l(Array.isArray(c[j+t])?[]:{},c[j+t],f));if(n.length&&p.insertBefore(o,g[j+k]||this.relateEl),!d)for(var w=r-k+m;r>w;w++)delete this.vm[w];b=b.slice(0,2).concat(n),g.splice.apply(g,b),k!==m&&this.vm.$$getChild("length").$$render(g.length)},reverse:function(b,c,d){for(var e,f=this.vm,g=this.relateEl,h=a.createDocumentFragment(),i=0,j=this.els.length;j>i;i++)!d&&.5>i&&(e=f[i],f[i]=f[j-i-1],f[i].$$path=i+"",e.$$path=j-i-1+"",f[j-i-1]=e),this.els[i][E+"index"]=j-i-1,h.appendChild(this.els[j-i-1]);g.parentNode.insertBefore(h,g),this.els.reverse()},sort:function(){this.update()}},function(b,c,d){var e=a.createTextNode(""),f=d.el,g=d.nodeName;this.__super__.apply(this,arguments),this.path=f.getAttribute(g),f.removeAttribute(g),this.type=g,this.relateEl=e,this.els=[],g===H.IF&&h(this.el,c),f.parentNode.insertBefore(e,f),f.parentNode.removeChild(f)}),P=/(?:\.|\[)/g,Q=/\]/g;return d});