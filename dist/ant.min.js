/*! ant.js 2013-08-06 02:00 */
!function(a,b){if("object"==typeof module&&module){var c=require("jsdom"),d=c.jsdom();module.exports=b(d)}else"function"==typeof define&&define(function(){return b()}),a.Ant=b()}(this,function(a){"use strict";function b(a){var c,d,e,f,g=arguments.length;a=a||{};for(var h=1;g>h;h++)if(null!==(c=arguments[h]))for(var i in c)d=a[i],e=c[i],a!==e&&"__ant__"!==i&&(s(e)?(f=Array.isArray(e)?d&&Array.isArray(d)?d:[]:d||{},a[i]=b(f,e)):a[i]=e);return a}function c(a){a&&(B=a,C=B+"if",D=B+"repeat",E=B+"model")}function d(a,b){b=b||{};var c,d=b.data||{},f=b.events||{};c=g(a,b.el),a=c.tpl,c=c.el,d=this.parse(d,b),this.template=a,this.el=c,this.data=d,this.isRendered=!1,this.addBinding=K,"function"==typeof b.addBinding&&(this.addBinding=w(K,b.addBinding)),this.isLazy=!!b.lazy,this.partials=b.partials,this.options=b,i(this);for(var h in f)this.on(h,f[h]);b.data&&(e(d,this),this.render()),this.init.apply(this,arguments)}function e(a,b){function c(a){var d;for(var e in a)d=a[e],"object"==typeof d&&"__ant__"!==e&&(Array.isArray(d)&&(d.__ant__=b,f(d,b)),c(d))}c(a)}function f(a){for(var b in I)a[b]=I[b]}function g(b,c){var d;return s(b)?(c?(d=c=s(c)?c:a.createElement(c),d.innerHTML="",c.appendChild(b)):d=b,b=d.outerHTML):(d=s(c)?c:a.createElement(c||"div"),d.innerHTML=b),{el:d,tpl:b}}function h(a,b,c){a.vm.$$render(b,c),1>=c&&(a.isRendered=!0)}function i(a){var b=new m;b.$$root=b,b.$$ant=a,a.vm=b,j(a.el,b)}function j(a,b){if(a.nodeType&&!a.length)k(a,b);else for(var c=0,d=a.length;d>c;c++)k(a[c],b)}function k(a,b){if(8!==a.nodeType){if(3===a.nodeType)return b.$$updateVM(a,a.parentNode),void 0;var c,d,e=a.getAttribute(D),f=a.getAttribute(C),g=a.getAttribute(E);if(e?(b.$$getChild(e).$$addGenerator(a,b.$$getChild(e),q.TYPE_REPEAT),c=!0):f?(f=f.replace(L,""),b.$$getChild(f).$$addGenerator(a,b.$$getChild(f),q.TYPE_IF),c=!0):g&&l(a,g,b),!c){for(var f=0,h=a.attributes.length;h>f;f++)n(a.attributes[f].nodeName)||b.$$updateVM(a.attributes[f],a);for(var i=a.firstChild;i;)d=i.nextSibling,3===i.nodeType?b.$$updateVM(i,i.parentNode):k(i,b),i=d}}}function l(a,b,c){var d,e=c.$$root.$$ant,f=c.$$getChild(b),g="change",h=d="value",i=t(e.get(f.$$keyPath)),j=/\r\n/g,k=function(b,c){var e=b.$$getData(c)||"",f=a[d];f&&f.replace&&(f=f.replace(j,"\n")),e!==f&&(a[d]=e)},l=function(){var b=a[h];b.replace&&(b=b.replace(j,"\n")),e.set(f.$$keyPath,b)};switch(a.tagName){case"INPUT":case"TEXTAREA":switch(a.type){case"checkbox":h=d="checked",a.attachEvent&&(g+=" click");break;case"radio":d="checked",a.attachEvent&&(g+=" click"),k=function(b,c){a.checked=a.value===b.$$getData(c)},i=a.checked;break;default:e.isLazy||("oninput"in a&&(g+=" input"),a.attachEvent&&(g+=" keyup propertychange cut"))}break;case"SELECT":a.multiple&&(l=function(){for(var b=[],c=0,d=a.options.length;d>c;c++)a.options[c].selected&&b.push(a.options[c].value);e.set(f.$$keyPath,b)},k=function(b,c){for(var d=b.$$getData(c),e=0,f=a.options.length;f>e;e++)a.options[e].selected=d&&-1!==d.indexOf(a.options[e].value)}),i=i&&!n(a[h])}f.$$watchers.push(k),g.split(/\s+/g).forEach(function(b){A(a,b,l),z(a,b,l)}),a.removeAttribute(E),a[h]&&i&&l()}function m(){this.$$keyPath="",this.$$watchers=[]}function n(a){return a&&J.test(a)}function o(a,b){var c,d,e,f,g=[],h=[],i=0,j=a.nodeValue;if(3===a.nodeType)d="text";else{if(2!==a.nodeType)return console.error("我们需要一个文本节点或者属性节点"),void 0;d="attr",e=a.nodeName,0===(f=e.indexOf(B))&&(e=a.nodeName.slice(B.length))}for(J.lastIndex=0;c=J.exec(j);)J.lastIndex-i>c[0].length&&h.push(j.slice(i,J.lastIndex-c[0].length)),g.push({escape:!c[2],path:(c[2]||c[1]).trim(),position:h.length}),h.push(c[0]),i=J.lastIndex;return j.length>i&&h.push(j.slice(i,j.length)),{tokens:g,textMap:h,node:a,type:d,refNodeName:e,el:b}}function p(b,c,d){var e=c.position,f=d.node,g=d.textMap,h=d.refNodeName;if(b+""!=g[e]+""){if(f.nodeValue!==g.join("")&&c.escape)return console.warn("没有更新内容. 因为模板内容已被其他程序修改!"),void 0;if(g[e]=b&&b+"",c.escape||"text"!==d.type)f.nodeValue=g.join(""),h&&"attr"===d.type&&("style"===h&&d.el.style.setAttribute?d.el.style.setAttribute("cssText",f.nodeValue):d.el.setAttribute(d.refNodeName,f.nodeValue));else{var i,j=a.createElement("div");c.unescapeNodes=c.unescapeNodes||[],j.innerHTML=g.join(""),i=j.childNodes,c.unescapeNodes.forEach(function(a){a.parentNode&&a.parentNode.removeChild(a)}),c.unescapeNodes=[];for(var k=0,l=i.length;l>k;k++)c.unescapeNodes.push(i[k]),f.parentNode.insertBefore(i[k],f),k--,l--;f.nodeValue=""}}}function q(a,b,c){for(var d,e=a,f=c===q.TYPE_IF?C:D;;){if(e=e.nextSibling,e&&e.hasAttributes){if(q.isGenTempl(e))continue;d="sibling";break}e=a.parentNode,d="parent";break}this.path=a.getAttribute(f),a.removeAttribute(f),f===C&&k(a,b.$$parent),this.el=a,this.vm=b,this.type=c,this.relateEl=e,this.relateType=d,this.instances=[],this.state=this.STATE_READY,a.parentNode&&a.parentNode.removeChild(a)}function r(){}function s(a){return"object"==typeof a&&null!==a}function t(a){return"undefined"==typeof a}function u(a,b,c){return function(){var d=b.apply(this,arguments);return c&&c.call(this,d)?d:a.apply(this,arguments)}}function v(a,b,c){return function(){var d=a.apply(this,arguments);return c&&c.call(this,d)?d:(b.apply(this,arguments),d)}}function w(a,b){return u(a,b,function(a){return a===!1})}function x(a,b,c){var d=a.replace(O,"").split(N),e=c;return d.forEach(function(a,c){c===d.length-1?e[a]=b:e&&e.hasOwnProperty(a)?e=e[a]:(e[a]=d[c+1]&&/^\d+$/.test(d[c+1])?[]:{},e=e[a])}),c}function y(a,b){for(var c,d=a.replace(O,"").split(N),e=b,f=0,g=d.length;g>f;f++){if(c=d[f],!e||!e.hasOwnProperty(c))return;e=e[c]}return e}function z(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function A(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.detachEvent("on"+b,c)}a=a||document;var B,C,D,E,F={on:function(a,b,c){var d=c||this;return d._handlers=d._handlers||{},d._handlers[a]=d._handlers[a]||[],d._handlers[a].push({handler:b,context:c,ctx:d}),this},off:function(a,b,c){var d=c||this,e=d._handlers;if(a&&e[a])if("function"==typeof b)for(var f=0;f<e[a].length;f++)e[a][f].handler===b&&(e[a].splice(f,1),f--);else e[a]=[];return this},trigger:function(a){var b=this,c=[].slice.call(arguments,1),d=b._handlers;return d&&d[a]&&d[a].forEach(function(a){a.handler.apply(b,c)}),this}},G={extend:function(a,c){var d=this,e=function(){return d.apply(this,arguments)},f=function(){this.constructor=e};return f.prototype=d.prototype,e.prototype=new f,b(e.prototype,a),b(e,d,c),e}},H={RENDER:0,RESET:1,EXTEND:2,ARRAY_REPLACE:3};c("a-"),b(d,G,{RENDER_TYPE:H,setPrefix:c,Event:F}),b(d.prototype,F,{update:function(a,b,c){var d;s(a)?(c=b,b=a):"string"==typeof a&&t(b)&&(b=x(a,d=this.get(a),{}),c=Array.isArray(d)?H.ARRAY_REPLACE:H.EXTEND),t(c)&&(c=H.EXTEND),h(this,b||this.data,c),this.trigger("update",b)},render:function(a){h(this,a||this.data,H.RENDER),this.trigger("render")},reset:function(a){this.set(a,{type:H.RESET}),this.trigger("reset")},clone:function(a){return new this.constructor(this.template,b(this.options,a))},get:function(a){return y(a,this.data)},set:function(a,c,d){var f,g,h,i={};if(!a)return this;if(s(a)){d=c,d=d||{},i=this.parse(a,d),a="";for(var j in i)this.data[j]!==i[j]&&(this.data[j]=i[j],d.silence||(f=!0,h=d.type))}else d=d||{},g=y(a,this.data),x(a,c,i),c=y(a,i),i=this.parse(i,d),d.silence||g===c||(b(this.data,i),f=!0,h=t(d.type)?Array.isArray(g)?H.ARRAY_REPLACE:H.EXTEND:opts.type);e(i,this),f&&this.update(i,h)},_virtual:function(){},parse:function(a){return a},init:r});var I={splice:v([].splice,function(){this.__ant__.update(null,null,3)}),push:v([].push,function(){this.__ant__.update(null,null,3)}),pop:v([].pop,function(){this.__ant__.update(null,null,3)}),sort:v([].sort,function(){this.__ant__.update(null,null,3)}),reverse:v([].reverse,function(){this.__ant__.update(null,null,3)}),unshift:v([].unshift,function(){this.__ant__.update(null,null,3)}),shift:v([].shift,function(){this.__ant__.update(null,null,3)})};m.prototype={$$watchers:null,$$root:null,$$parent:null,$$generators:null,$$ant:null,$$data:null,$$keyPath:null,$$updateVM:function(a,b){n(a.nodeValue)&&this.$$addWatcher(a,b)},$$getChild:function(a){var b,c,d,e=this;d=a.split(/(?!^)\.(?!$)/);for(var f=0,g=d.length;g>f;f++)b=d[f],e[b]||(c=new m,c.$$parent=e,c.$$root=e.$$root||e,c.$$keyPath=e.$$keyPath+(e.$$keyPath&&".")+b,e[b]=c),e=e[b];return e},$$addWatcher:function(b,c){var d=o(b,c),e=d.tokens,f=d.textMap,g=this;"text"===d.type&&f.length>1?(f.forEach(function(d){var e=a.createTextNode(d);c.insertBefore(e,b),g.$$updateVM(e,c)}),c.removeChild(b)):e.forEach(function(a){K(d,g,a)})},$$addGenerator:function(a,b,c){this.$$generators=this.$$generators||[];var d=new q(a,b,c);return this.$$generators.push(d),d},$$getData:function(a,b){if(b)return this.$$data[a];for(var c=this;c;c=c.$$parent)if(s(c.$$data)&&a in c.$$data)return c.$$data[a]},$$render:function(a,b){var c,d=this;d.$$data=a;for(var e in d)if(!(!d.hasOwnProperty(e)||e in m.prototype||b>=H.EXTEND&&s(a)&&!(e in a))){if(c=d.$$getChild(e),c.$$generators&&c.$$generators.length)for(var f=0,g=c.$$generators.length;g>f;f++)(c.$$generators[f].type==q.TYPE_IF||0===c.$$generators[f].state||b!==H.EXTEND)&&c.$$generators[f].generate(a,e);if(d[e].$$watchers.length)for(var f=0,g=c.$$watchers.length;g>f;f++)c.$$watchers[f](d,e);(!t(a[e])||b<H.EXTEND)&&c.$$render(t(a[e])?{}:a[e],b)}}};var J=/{{({([^{}\n]+)}|[^{}\n]+)}}/g,K=function(a,b,c){var d=b.$$getChild(c.path);d.$$watchers.push(function(b,d){var e="."===d?b.$$data:b.$$getData(d);p(e,c,a)})},L=/^\^/;K=w(K,function(a,b,c){var d=c.path,e=d.split(":");if(2===e.length){var f=e[0].trim(),g=e[1].trim();return b.$$getChild(f.replace(L,"")).$$watchers.push(function(b,d){var e=b.$$getData(d),h=(L.test(f)?!e:e)?g:"";p(h,c,a)}),!1}});var M=/^>\s*(?=.+)/;K=w(K,function(b,c,d){var e,f,h,i,l=b.node.parentNode;if("text"===b.type&&M.test(d.path)){if(e=d.path.replace(M,""),h=c.$$root.$$ant,h.partials&&(f=h.partials[e]))if(d.escape&&!s(f))i=a.createTextNode(f),l.insertBefore(i,b.node),k(i,c);else{i=g(f).el.childNodes,j(i,c);for(var m=0,n=i.length;n>m;m++)l.insertBefore(i[0],b.node)}return l.removeChild(b.node),!1}}),b(q,{TYPE_REPEAT:"repeat",TYPE_IF:"if",isGenTempl:function(a){return a&&a.hasAttributes&&a.hasAttributes(D)||a.hasAttributes(C)}}),q.prototype={STATE_READY:0,STATE_GENEND:1,generate:function(b,c){var d=this,e=a.createDocumentFragment(),f=b[c];if(d.type===q.TYPE_REPEAT){if(f&&!Array.isArray(f))return console.warn(JSON.stringify(f)+" 应该是一个数组"),void 0;d.empty(),f&&f.forEach(function(a,b){var c=d.el.cloneNode(!0),f=d.vm.$$getChild(b+"");e.appendChild(c),k(c,f),f.$$render(a),d.instances.push(c)})}else L.test(this.path)&&(f=!f),f?d.lastIfState||e.appendChild(d.el):d.lastIfState&&d.el.parentNode.removeChild(d.el),d.lastIfState=f;"sibling"===d.relateType?d.relateEl.parentNode.insertBefore(e,d.relateEl):d.relateEl.appendChild(e),d.state=this.STATE_GENEND},splice:function(){},empty:function(){var a=this;this.instances.forEach(function(b,c){b.parentNode&&11!==b.parentNode.nodeType&&b.parentNode.removeChild(b),delete a.vm[c]}),this.instances=[]}};var N=/(?:\.|\[)/g,O=/\]/g;return d});